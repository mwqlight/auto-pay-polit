Metadata-Version: 2.4
Name: autopay-sdk
Version: 1.0.0
Summary: AutoPay Python SDK - ç®€æ´æ˜“ç”¨çš„æ”¯ä»˜SDK
Author-email: AutoPay Team <team@autopay.com>
License: MIT
Project-URL: Homepage, https://github.com/autopay/python-sdk
Project-URL: Repository, https://github.com/autopay/python-sdk.git
Project-URL: Documentation, https://autopay.readthedocs.io/
Project-URL: Changelog, https://github.com/autopay/python-sdk/blob/main/CHANGELOG.md
Project-URL: Bug Tracker, https://github.com/autopay/python-sdk/issues
Keywords: payment,alipay,wechat,sdk,autopay,mobile,web,china
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Internet :: WWW/HTTP
Classifier: Topic :: Office/Business :: Financial :: Point-Of-Sale
Requires-Python: >=3.7
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.25.0
Requires-Dist: aiohttp>=3.8.0
Requires-Dist: aiohttp_socks>=0.8.0
Requires-Dist: cryptography>=3.4.0
Requires-Dist: pydantic>=1.8.0
Requires-Dist: typing-extensions>=4.0.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.18.0; extra == "dev"
Requires-Dist: pytest-cov>=3.0.0; extra == "dev"
Requires-Dist: pytest-mock>=3.6.0; extra == "dev"
Requires-Dist: black>=21.0.0; extra == "dev"
Requires-Dist: isort>=5.0.0; extra == "dev"
Requires-Dist: flake8>=4.0.0; extra == "dev"
Requires-Dist: mypy>=0.950; extra == "dev"
Requires-Dist: bandit>=1.7.0; extra == "dev"
Provides-Extra: async
Requires-Dist: aiohttp>=3.8.0; extra == "async"
Requires-Dist: asyncio-throttle>=1.0.0; extra == "async"

# AutoPay Python SDK

[![Python Version](https://img.shields.io/badge/python-3.8%2B-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)]()

ç®€æ´æ˜“ç”¨çš„æ”¯ä»˜æœåŠ¡ Python SDKï¼Œæ”¯æŒåŒæ­¥/å¼‚æ­¥æ“ä½œï¼Œå®Œæ•´ç±»å‹æç¤ºï¼Œå†…ç½®é‡è¯•æœºåˆ¶ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **ç®€æ´æ˜“ç”¨**: ä¸€è¡Œä»£ç åˆ›å»ºæ”¯ä»˜ï¼Œé“¾å¼è°ƒç”¨æ›´ä¼˜é›…
- ğŸ”„ **åŒæ­¥/å¼‚æ­¥**: æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§ç¼–ç¨‹æ¨¡å¼
- ğŸ”’ **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹æç¤ºï¼ŒIDEæ™ºèƒ½æç¤ºæ”¯æŒ
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸ä½“ç³»ï¼Œç²¾å‡†é”™è¯¯å®šä½
- âš¡ **é«˜æ€§èƒ½**: è¿æ¥æ± å¤ç”¨ï¼Œæ”¯æŒè¯·æ±‚å¹¶å‘
- ğŸ”„ **æ™ºèƒ½é‡è¯•**: ç½‘ç»œå¼‚å¸¸è‡ªåŠ¨é‡è¯•ï¼Œå¯é…ç½®ç­–ç•¥
- ğŸ“Š **æ•°æ®å®Œæ•´**: æ‰€æœ‰APIæ¥å£å…¨è¦†ç›–
- ğŸ§ª **æµ‹è¯•å®Œå–„**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡>90%

## ğŸ“¦ å®‰è£…

### ä½¿ç”¨ pip å®‰è£…

```bash
pip install autopay-sdk
```

### å¼€å‘ç‰ˆæœ¬å®‰è£…

```bash
git clone https://github.com/autopay/python-sdk.git
cd python-sdk
pip install -e .
```

### å®Œæ•´åŠŸèƒ½å®‰è£…

```bash
# åŒ…å«æ‰€æœ‰å¯é€‰ä¾èµ–
pip install autopay-sdk[dev,async,all]
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```python
from autopay import create_client

# åˆ›å»ºå®¢æˆ·ç«¯
client = create_client(
    api_key="your_api_key",
    secret_key="your_secret_key",
    environment="sandbox"  # sandbox æˆ– production
)

# åˆ›å»ºæ”¯ä»˜
payment = client.get_payment_service().create_payment({
    "amount": 100.00,
    "currency": "CNY",
    "method": "alipay",
    "description": "æµ‹è¯•è®¢å•",
    "order_id": "ORDER_123456"
})

print(f"æ”¯ä»˜ID: {payment.payment_id}")
print(f"æ”¯ä»˜URL: {payment.payment_url}")

# éªŒè¯æ”¯ä»˜çŠ¶æ€
is_success = client.verify_payment(payment.payment_id)
print(f"æ”¯ä»˜æ˜¯å¦æˆåŠŸ: {is_success}")

# æ¸…ç†èµ„æº
client.cleanup()
```

### å¼‚æ­¥ä½¿ç”¨

```python
import asyncio
from autopay import AsyncHttpClient, Config

async def async_example():
    config = Config(
        api_key="your_api_key",
        secret_key="your_secret_key",
        environment="sandbox"
    )
    
    async with AsyncHttpClient(config) as http_client:
        # å¹¶å‘åˆ›å»ºå¤šä¸ªæ”¯ä»˜
        tasks = []
        for i in range(5):
            task = http_client.post('/api/v1/payments', {
                "amount": 100.00 + i * 10,
                "currency": "CNY", 
                "method": "wechat_pay",
                "description": f"è®¢å•{i+1}"
            })
            tasks.append(task)
        
        results = await asyncio.gather(*tasks)
        
        for i, result in enumerate(results):
            print(f"è®¢å•{i+1}: {result.get('data', {}).get('payment_id')}")

# è¿è¡Œå¼‚æ­¥å‡½æ•°
asyncio.run(async_example())
```

### é«˜çº§åŠŸèƒ½

```python
from autopay import AutoPayService, PaymentRequest, PaymentMethod, Decimal

# ä½¿ç”¨é…ç½®æ„å»ºå™¨
from autopay.config import ConfigBuilder

config = ConfigBuilder() \
    .with_api_key("your_api_key") \
    .with_secret_key("your_secret_key") \
    .with_environment("sandbox") \
    .with_timeout(60) \
    .with_retry_config(max_retries=3, base_delay=1.0) \
    .build()

client = AutoPayService(config)

# åˆ›å»ºå¤æ‚æ”¯ä»˜
payment_request = PaymentRequest(
    amount=Decimal("299.99"),
    currency="CNY",
    method=PaymentMethod.WECHAT_PAY,
    description="é«˜çº§åŠŸèƒ½æµ‹è¯•",
    notify_url="https://your-domain.com/webhook",
    return_url="https://your-domain.com/return"
)

payment_response = client.get_payment_service().create_payment(payment_request)

# è·å–æ¸ é“å¥åº·çŠ¶æ€
health_summary = client.get_channel_health_summary()
print(f"å¥åº·æ¸ é“æ•°: {health_summary['healthy_channels']}")

# æ‰¹é‡é€€æ¬¾
batch_refunds = [
    {"payment_id": "pay_123", "amount": 50.00, "reason": "å•†å“è´¨é‡é—®é¢˜"},
    {"payment_id": "pay_124", "amount": 30.00, "reason": "é‡å¤ä¸‹å•"}
]

result = client.batch_refund(batch_refunds)
print(f"æ‰¹é‡é€€æ¬¾ç»“æœ: {result}")
```

## ğŸ“š API æ–‡æ¡£

### æ ¸å¿ƒç±»

#### AutoPayService
ä¸»è¦çš„SDKå…¥å£ç±»ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡æ¨¡å—ã€‚

```python
class AutoPayService:
    def create(**config_kwargs) -> AutoPayService
    def get_payment_service() -> PaymentService
    def get_refund_service() -> RefundService
    def get_channel_service() -> ChannelService
    def get_account_service() -> AccountService
    def get_system_service() -> SystemService
    def get_webhook_service() -> WebhookService
```

#### æ”¯ä»˜æœåŠ¡ (PaymentService)

```python
class PaymentService:
    def create_payment(request: PaymentRequest) -> PaymentResponse
    def query_payment(payment_id: str) -> PaymentInfo
    def close_payment(payment_id: str) -> bool
    def get_payment_list(params: PaymentListRequest) -> PaginatedResponse[PaymentInfo]
    def get_payment_statistics(params: StatisticsRequest) -> StatisticsResponse
    def verify_payment(payment_id: str, order_id: str = None) -> Dict[str, Any]
    def cancel_payment(payment_id: str) -> bool
```

#### é€€æ¬¾æœåŠ¡ (RefundService)

```python
class RefundService:
    def create_refund(request: RefundRequest) -> RefundResponse
    def query_refund(refund_id: str) -> RefundInfo
    def cancel_refund(refund_id: str) -> bool
    def get_refund_list(params: RefundListRequest) -> PaginatedResponse[RefundInfo]
    def get_refund_statistics(params: StatisticsRequest) -> StatisticsResponse
    def batch_refund(refunds: List[Dict[str, Any]]) -> Dict[str, Any]
```

#### æ¸ é“æœåŠ¡ (ChannelService)

```python
class ChannelService:
    def get_channels(params: ChannelListRequest) -> PaginatedResponse[ChannelInfo]
    def get_channel(channel_id: str) -> ChannelInfo
    def get_default_channel(method: PaymentMethod) -> ChannelInfo
    def update_channel_status(channel_id: str, status: ChannelStatus) -> bool
    def get_channel_health() -> List[ChannelHealth]
    def get_channel_statistics(params: StatisticsRequest) -> ChannelStatistics
    def test_channel_connectivity(channel_id: str) -> Dict[str, Any]
```

### æ•°æ®æ¨¡å‹

#### æ”¯ä»˜ç›¸å…³

```python
class PaymentRequest(BaseModel):
    amount: Decimal
    currency: str
    method: PaymentMethod
    description: Optional[str] = None
    order_id: Optional[str] = None
    notify_url: Optional[str] = None
    return_url: Optional[str] = None

class PaymentResponse(BaseModel):
    payment_id: str
    order_id: str
    amount: Decimal
    currency: str
    method: PaymentMethod
    status: PaymentStatus
    payment_url: Optional[str] = None
    qr_code: Optional[str] = None
    created_at: datetime
    expires_at: Optional[datetime] = None
```

#### é€€æ¬¾ç›¸å…³

```python
class RefundRequest(BaseModel):
    payment_id: str
    amount: Decimal
    reason: str
    type: RefundType = RefundType.PARTIAL
    metadata: Optional[Dict[str, Any]] = None

class RefundResponse(BaseModel):
    refund_id: str
    payment_id: str
    amount: Decimal
    reason: str
    status: RefundStatus
    created_at: datetime
    processed_at: Optional[datetime] = None
```

### å¼‚å¸¸å¤„ç†

SDKæä¾›å®Œæ•´çš„å¼‚å¸¸ä½“ç³»ï¼š

```python
from autopay.exceptions import (
    AutoPayException,           # åŸºç¡€å¼‚å¸¸
    ConfigurationException,     # é…ç½®é”™è¯¯
    ValidationException,        # å‚æ•°éªŒè¯é”™è¯¯
    NetworkException,           # ç½‘ç»œé”™è¯¯
    TimeoutException,           # è¶…æ—¶é”™è¯¯
    AuthenticationException,    # è®¤è¯é”™è¯¯
    RateLimitException,         # é¢‘ç‡é™åˆ¶
    BusinessException,          # ä¸šåŠ¡é”™è¯¯
    ServiceUnavailableException # æœåŠ¡ä¸å¯ç”¨
)

try:
    payment = client.get_payment_service().create_payment(request)
except ValidationException as e:
    print(f"å‚æ•°é”™è¯¯: {e}")
except NetworkException as e:
    print(f"ç½‘ç»œé”™è¯¯: {e}")
    # å¯ä»¥é…ç½®é‡è¯•ç­–ç•¥
except Exception as e:
    print(f"å…¶ä»–é”™è¯¯: {e}")
```

## ğŸ› ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒé…ç½®

```python
from autopay import Environment

# æ”¯æŒçš„ç¯å¢ƒ
Environment.SANDBOX      # æ²™ç®±ç¯å¢ƒ
Environment.PRODUCTION   # ç”Ÿäº§ç¯å¢ƒ
```

### å®¢æˆ·ç«¯é…ç½®

```python
from autopay.config import ConfigBuilder

config = ConfigBuilder() \
    .with_api_key("your_api_key") \
    .with_secret_key("your_secret_key") \
    .with_environment(Environment.SANDBOX) \
    .with_base_url("https://api.autopay.com") \
    .with_timeout(30) \
    .with_connect_timeout(10) \
    .with_read_timeout(30) \
    .with_retry_config(max_retries=3, base_delay=1.0, max_delay=60.0) \
    .with_rate_limit(requests=100, window=60) \
    .with_proxy_url("http://proxy.com:8080") \
    .with_user_agent("YourApp/1.0") \
    .build()
```

### å®Œæ•´é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `api_key` | str | - | APIå¯†é’¥ |
| `secret_key` | str | - | å¯†é’¥ |
| `environment` | Environment | SANDBOX | ç¯å¢ƒ |
| `base_url` | str | - | åŸºç¡€URL |
| `timeout_seconds` | int | 30 | è¯·æ±‚è¶…æ—¶ |
| `connect_timeout_seconds` | int | 10 | è¿æ¥è¶…æ—¶ |
| `read_timeout_seconds` | int | 30 | è¯»å–è¶…æ—¶ |
| `max_retries` | int | 3 | æœ€å¤§é‡è¯•æ¬¡æ•° |
| `base_delay` | float | 1.0 | é‡è¯•åŸºç¡€å»¶è¿Ÿ |
| `max_delay` | float | 60.0 | æœ€å¤§å»¶è¿Ÿ |
| `rate_limit_requests` | int | 100 | è¯·æ±‚é¢‘ç‡é™åˆ¶ |
| `rate_limit_window` | int | 60 | é¢‘ç‡é™åˆ¶çª—å£(ç§’) |
| `proxy_url` | str | None | ä»£ç†URL |
| `user_agent` | str | None | ç”¨æˆ·ä»£ç† |
| `enable_logging` | bool | True | æ˜¯å¦å¯ç”¨æ—¥å¿— |
| `connection_pool_size` | int | 100 | è¿æ¥æ± å¤§å° |
| `connection_pool_size_per_host` | int | 30 | æ¯ä¸»æœºè¿æ¥æ± å¤§å° |

## ğŸ”§ å·¥å…·å‡½æ•°

SDKæä¾›ä¸°å¯Œçš„å·¥å…·å‡½æ•°ï¼š

```python
from autopay import (
    generate_order_id,      # ç”Ÿæˆè®¢å•å·
    generate_payment_id,    # ç”Ÿæˆæ”¯ä»˜å·
    generate_signature,     # ç”Ÿæˆç­¾å
    verify_signature,       # éªŒè¯ç­¾å
    format_decimal,         # æ ¼å¼åŒ–å°æ•°
    format_currency,        # æ ¼å¼åŒ–è´§å¸
    mask_sensitive_data,    # æ©ç æ•æ„Ÿæ•°æ®
    calculate_percentage,   # è®¡ç®—ç™¾åˆ†æ¯”
    retry_with_backoff,     # é‡è¯•è£…é¥°å™¨
    validate_required_fields # éªŒè¯å¿…å¡«å­—æ®µ
)

# ç”Ÿæˆè®¢å•å·
order_id = generate_order_id("ORDER")

# æ ¼å¼åŒ–é‡‘é¢
amount_str = format_decimal("123.456", 2)  # "123.46"

# æ©ç æ•æ„Ÿä¿¡æ¯
masked_card = mask_sensitive_data("1234567890123456")  # "12********3456"
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_payment.py

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=autopay tests/

# å¹¶è¡Œè¿è¡Œæµ‹è¯•
pytest -n auto
```

### æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ test_config.py          # é…ç½®æµ‹è¯•
â”œâ”€â”€ test_client.py          # å®¢æˆ·ç«¯æµ‹è¯•
â”œâ”€â”€ test_payment.py         # æ”¯ä»˜æœåŠ¡æµ‹è¯•
â”œâ”€â”€ test_refund.py          # é€€æ¬¾æœåŠ¡æµ‹è¯•
â”œâ”€â”€ test_channel.py         # æ¸ é“æœåŠ¡æµ‹è¯•
â”œâ”€â”€ test_account.py         # è´¦æˆ·æœåŠ¡æµ‹è¯•
â”œâ”€â”€ test_system.py          # ç³»ç»ŸæœåŠ¡æµ‹è¯•
â”œâ”€â”€ test_webhook.py         # WebhookæœåŠ¡æµ‹è¯•
â”œâ”€â”€ test_exceptions.py      # å¼‚å¸¸å¤„ç†æµ‹è¯•
â”œâ”€â”€ test_utils.py           # å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ conftest.py             # æµ‹è¯•é…ç½®
â””â”€â”€ fixtures/               # æµ‹è¯•æ•°æ®
```

### ç¼–å†™æµ‹è¯•

```python
import pytest
from autopay import create_client, PaymentRequest, PaymentMethod
from autopay.exceptions import ValidationException

class TestPaymentService:
    def test_create_payment_success(self):
        client = create_client(
            api_key="test_key",
            secret_key="test_secret",
            environment="sandbox"
        )
        
        payment = client.get_payment_service().create_payment({
            "amount": 100.00,
            "currency": "CNY",
            "method": "alipay",
            "description": "æµ‹è¯•è®¢å•"
        })
        
        assert payment.payment_id is not None
        assert payment.amount == 100.00
        assert payment.currency == "CNY"
    
    def test_create_payment_invalid_amount(self):
        client = create_client(
            api_key="test_key",
            secret_key="test_secret", 
            environment="sandbox"
        )
        
        with pytest.raises(ValidationException):
            client.get_payment_service().create_payment({
                "amount": -100,  # è´Ÿæ•°é‡‘é¢
                "currency": "CNY",
                "method": "alipay"
            })
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. é…ç½®ç®¡ç†

```python
# æ¨èï¼šä½¿ç”¨é…ç½®æ„å»ºå™¨
from autopay.config import ConfigBuilder

config = ConfigBuilder() \
    .with_api_key(os.environ["AUTOPAY_API_KEY"]) \
    .with_secret_key(os.environ["AUTOPAY_SECRET_KEY"]) \
    .with_environment("sandbox" if DEBUG else "production") \
    .with_timeout(30) \
    .build()

client = AutoPayService(config)
```

### 2. é”™è¯¯å¤„ç†

```python
from autopay.exceptions import (
    NetworkException, 
    ValidationException, 
    RateLimitException
)

def create_payment_safe(request):
    max_retries = 3
    for attempt in range(max_retries):
        try:
            return client.get_payment_service().create_payment(request)
        except NetworkException as e:
            if attempt == max_retries - 1:
                raise
            time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
        except ValidationException as e:
            # éªŒè¯é”™è¯¯ä¸é‡è¯•
            raise
        except RateLimitException as e:
            if attempt == max_retries - 1:
                raise
            time.sleep(60)  # ç­‰å¾…1åˆ†é’Ÿ
```

### 3. å¼‚æ­¥ç¼–ç¨‹

```python
import asyncio
from autopay import AsyncHttpClient

async def create_multiple_payments():
    async with AsyncHttpClient(config) as http_client:
        # ä½¿ç”¨ä¿¡å·é‡é™åˆ¶å¹¶å‘
        sem = asyncio.Semaphore(10)
        
        async def create_single_payment(i):
            async with sem:
                return await http_client.post('/api/v1/payments', {
                    "amount": 100.00 + i * 10,
                    "currency": "CNY",
                    "method": "alipay"
                })
        
        # åˆ›å»º20ä¸ªæ”¯ä»˜
        tasks = [create_single_payment(i) for i in range(20)]
        results = await asyncio.gather(*tasks)
        
        return results
```

### 4. Webhookå¤„ç†

```python
from autopay import WebhookService, WebhookEvent

webhook_service = WebhookService(http_client, secret_key)

# äº‹ä»¶å¤„ç†å™¨æ˜ å°„
event_handlers = {
    "payment.succeeded": handle_payment_succeeded,
    "payment.failed": handle_payment_failed,
    "refund.succeeded": handle_refund_succeeded,
}

webhook_service.register_event_handlers(event_handlers)

# åœ¨Flask/Djangoè§†å›¾å‡½æ•°ä¸­ä½¿ç”¨
@app.route('/webhook', methods=['POST'])
def autopay_webhook():
    payload = request.get_json()
    signature = request.headers.get('X-AutoPay-Signature')
    
    try:
        result = webhook_service.handle_webhook(payload, signature)
        return {'status': 'success'}, 200
    except InvalidSignatureException:
        return {'status': 'invalid_signature'}, 400
    except Exception as e:
        return {'status': 'error', 'message': str(e)}, 500
```

### 5. æ€§èƒ½ä¼˜åŒ–

```python
# 1. ä½¿ç”¨è¿æ¥æ± 
config = ConfigBuilder() \
    .with_connection_pool_size(100) \
    .with_connection_pool_size_per_host(30) \
    .build()

# 2. å¯ç”¨HTTP/2
config = ConfigBuilder() \
    .with_http_version("2") \
    .build()

# 3. ä½¿ç”¨å¼‚æ­¥å®¢æˆ·ç«¯
async with AsyncHttpClient(config) as http_client:
    # å¹¶å‘è¯·æ±‚
    tasks = [http_client.get(f'/api/v1/payments/{i}') for i in range(100)]
    results = await asyncio.gather(*tasks)

# 4. æ‰¹é‡æ“ä½œ
batch_requests = [
    {"method": "GET", "endpoint": "/api/v1/payments/1"},
    {"method": "GET", "endpoint": "/api/v1/payments/2"},
    # ...
]
results = await http_client.batch_request(batch_requests)
```

## ğŸ”— é›†æˆæŒ‡å—

### FastAPI é›†æˆ

```python
from fastapi import FastAPI, Depends
from autopay import AutoPayService

app = FastAPI()

# åˆ›å»ºå…¨å±€å®¢æˆ·ç«¯
config = ConfigBuilder().from_environment().build()
autopay_client = AutoPayService(config)

@app.post("/payments")
async def create_payment(
    request: PaymentRequest,
    client: AutoPayService = Depends(get_autopay_client)
):
    try:
        payment = client.get_payment_service().create_payment(request)
        return {"payment_id": payment.payment_id}
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))

@app.get("/payments/{payment_id}")
async def get_payment(
    payment_id: str,
    client: AutoPayService = Depends(get_autopay_client)
):
    try:
        payment = client.get_payment_service().query_payment(payment_id)
        return payment.dict()
    except Exception as e:
        raise HTTPException(status_code=404, detail=str(e))
```

### Django é›†æˆ

```python
# settings.py
AUTOPAY_CONFIG = {
    'api_key': os.getenv('AUTOPAY_API_KEY'),
    'secret_key': os.getenv('AUTOPAY_SECRET_KEY'),
    'environment': 'sandbox' if DEBUG else 'production',
}

# utils.py
from django.conf import settings
from autopay import AutoPayService, ConfigBuilder

def get_autopay_client():
    config = ConfigBuilder() \
        .with_api_key(settings.AUTOPAY_CONFIG['api_key']) \
        .with_secret_key(settings.AUTOPAY_CONFIG['secret_key']) \
        .with_environment(settings.AUTOPAY_CONFIG['environment']) \
        .build()
    
    return AutoPayService(config)

# views.py
from django.http import JsonResponse
from .utils import get_autopay_client

def create_payment_view(request):
    if request.method == 'POST':
        client = get_autopay_client()
        
        try:
            payment = client.get_payment_service().create_payment({
                "amount": 100.00,
                "currency": "CNY",
                "method": "alipay"
            })
            
            return JsonResponse({
                "payment_id": payment.payment_id,
                "payment_url": payment.payment_url
            })
        except Exception as e:
            return JsonResponse({"error": str(e)}, status=400)
```

### Flask é›†æˆ

```python
from flask import Flask, request, jsonify
from autopay import AutoPayService

app = Flask(__name__)

# åˆ›å»ºå…¨å±€å®¢æˆ·ç«¯
config = ConfigBuilder() \
    .with_api_key(os.getenv('AUTOPAY_API_KEY')) \
    .with_secret_key(os.getenv('AUTOPAY_SECRET_KEY')) \
    .with_environment('sandbox') \
    .build()

client = AutoPayService(config)

@app.route('/payments', methods=['POST'])
def create_payment():
    data = request.get_json()
    
    try:
        payment = client.get_payment_service().create_payment(data)
        return jsonify({
            "payment_id": payment.payment_id,
            "payment_url": payment.payment_url
        })
    except Exception as e:
        return jsonify({"error": str(e)}), 400

@app.route('/webhook', methods=['POST'])
def autopay_webhook():
    # Webhookå¤„ç†é€»è¾‘
    payload = request.get_json()
    signature = request.headers.get('X-AutoPay-Signature')
    
    # éªŒè¯å’Œå¤„ç†é€»è¾‘
    return jsonify({"status": "ok"})
```

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—é…ç½®

```python
import logging
from autopay import create_client

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('autopay.log'),
        logging.StreamHandler()
    ]
)

client = create_client(
    api_key="your_api_key",
    secret_key="your_secret_key",
    environment="production",
    enable_logging=True
)
```

### æ€§èƒ½ç›‘æ§

```python
from autopay import AutoPayService
import time

class MonitoredAutoPayService(AutoPayService):
    def __init__(self, config):
        super().__init__(config)
        self.metrics = {
            'request_count': 0,
            'error_count': 0,
            'total_response_time': 0,
            'average_response_time': 0
        }
    
    def _record_request(self, response_time: float, is_error: bool = False):
        self.metrics['request_count'] += 1
        self.metrics['total_response_time'] += response_time
        
        if is_error:
            self.metrics['error_count'] += 1
        
        self.metrics['average_response_time'] = (
            self.metrics['total_response_time'] / self.metrics['request_count']
        )
    
    def get_metrics(self):
        return {
            **self.metrics,
            'error_rate': self.metrics['error_count'] / self.metrics['request_count']
        }
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å‚ä¸è´¡çŒ®ï¼š

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/autopay/python-sdk.git
cd python-sdk

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/macOS
# venv\Scripts\activate  # Windows

# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"

# å®‰è£…pre-commité’©å­
pre-commit install
```

### è´¡çŒ®æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª [PEP 8](https://pep8.org/) ä»£ç é£æ ¼
- æ·»åŠ å®Œæ•´çš„ç±»å‹æç¤º
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

### å¼€å‘è§„èŒƒ

```bash
# ä»£ç æ ¼å¼åŒ–
black src/ tests/

# å¯¼å…¥æ’åº
isort src/ tests/

# ä»£ç æ£€æŸ¥
flake8 src/ tests/
mypy src/

# è¿è¡Œæµ‹è¯•
pytest
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ å®Œæ•´çš„æ”¯ä»˜åŠŸèƒ½æ”¯æŒ
- ğŸ”„ åŒæ­¥å’Œå¼‚æ­¥å®¢æˆ·ç«¯
- ğŸ›¡ï¸ å®Œæ•´çš„å¼‚å¸¸å¤„ç†ä½“ç³»
- ğŸ“š è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹

## ğŸ“ æ”¯æŒ

- ğŸ“§ é‚®ç®±: sdk@autopay.com
- ğŸ’¬ å¾®ä¿¡: AutoPay-SDK
- ğŸ“š æ–‡æ¡£: https://docs.autopay.com/sdk/python
- ğŸ› BugæŠ¥å‘Š: https://github.com/autopay/python-sdk/issues
- ğŸ’¡ åŠŸèƒ½å»ºè®®: https://github.com/autopay/python-sdk/discussions

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

**Made with â¤ï¸ by AutoPay SDK Team**
